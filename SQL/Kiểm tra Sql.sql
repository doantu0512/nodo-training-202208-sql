CREATE  TABLE DOAN_TU_NXB(
    ID NUMBER(3) NOT NULL CONSTRAINT "PK_DOANTU_NXB" PRIMARY KEY ,
    MA NUMBER(3) UNIQUE ,
    TEN NVARCHAR2(50),
    TRANG_THAI NUMBER(1,0),
    DIA_CHI NVARCHAR2(50),
    MO_TA NVARCHAR2(50)
);
DROP TABLE DOAN_TU_NXB;
CREATE TABLE DOAN_TU_TACGIA(
    ID NUMBER(3) NOT NULL CONSTRAINT "PK_DOANTU_TACGIA" PRIMARY KEY ,
    MA_TACGIA NUMBER(3) UNIQUE,
    TEN_TAC_GIA NVARCHAR2(50),
    SDT_TAC_GIA VARCHAR(20),
    DIA_CHI_TAC_GIA NVARCHAR2(50),
    MO_TA_TAC_GIA NVARCHAR2(50)
);
DROP TABLE DOAN_TU_TACGIA;
CREATE TABLE DOAN_TU_SACH(
    ID NUMBER(3) NOT NULL CONSTRAINT "PK_DOANTU_SACH" PRIMARY KEY ,
    MA_SACH NUMBER(3) UNIQUE,
    TEN_SACH NVARCHAR2(50),
    ID_NXB NUMBER(3),
    ID_TACGIA NUMBER(3),
    CHUDE_SẠCH NVARCHAR2(50),
    NAMXUATBAN DATE,
    MO_TA_SACH NVARCHAR2(50),
    SOLUONGCONLAI NUMBER(3),
    SOLUONGDANGMUON NUMBER(3),
    TONGSOSACH NUMBER (5),
    CONSTRAINT "FK_DOANTU_NXB" FOREIGN KEY (ID_NXB) REFERENCES DOAN_TU_NXB(ID),
    CONSTRAINT "FK_DOANTU_TACGIA" FOREIGN KEY(ID_TACGIA) REFERENCES DOAN_TU_TACGIA(ID)
);
DROP TABLE DOAN_TU_SACH;
CREATE TABLE DOAN_TU_BANDOC(
    ID NUMBER(3) NOT NULL CONSTRAINT "PK_DOANTU_BANDOC" PRIMARY KEY ,
    MA_BANDOC NUMBER(3),
    TEN_BANDOC NVARCHAR2(50),
    SDT_BANDOC VARCHAR(20),
    DIACHI_BANDOC NVARCHAR2(50),
    NGAYSINH_BANDOC DATE,
    NGAYTAOTK_BANDOC DATE,
    HANG_BANDOC NVARCHAR2(10)
);
DROP TABLE DOAN_TU_MUONSACH;
CREATE TABLE DOAN_TU_MUONSACH(
    ID NUMBER(3) NOT NULL CONSTRAINT "PK_DOANTU_MUONSACH" PRIMARY KEY ,
    ID_BANDOC NUMBER (3),
    ID_SACH NUMBER(3),
    SOLUONG_MUONSACH NUMBER(3),
    NGAYMUON_MUONSACH DATE,
    NGAYTRA_MUONSACH DATE,
    TRANGTHAI_MUONSACH NUMBER(1,0),
    GHICHU_MUONSACH NVARCHAR2(50),
    CONSTRAINT "FK_DOANTU_BANDOC" FOREIGN KEY(ID_BANDOC) REFERENCES "DOAN_TU_BANDOC"(ID),
    CONSTRAINT "FK_DOANTU_SACH" FOREIGN KEY (ID_SACH) REFERENCES "DOAN_TU_SACH"(ID)
);
--BAITAP
--1.Viết script tạo cấu trúc các bảng. Đối với bảng Mượn Sách cần đánh partition trên trường ngày giờ mượn, và 2 local index: 1 index trên trường id bạn đọc, 1 index trên id sách. Tên indexes theo cấu trúc : TENBANG_IDX_TENTRUONG
--2.Viết script tạo sequence cho mỗi bảng. Sequence được dùng để insert trường Id cho các bảng. Tên sequence theo cấu trúc : TENBANG_SEQ
CREATE SEQUENCE DOAN_TU_NXB_SEQ
    INCREMENT BY 1
    START WITH 1
    MAXVALUE 10000
    NOCYCLE ;
CREATE SEQUENCE DOAN_TU_TACGIA_SEQ
    INCREMENT BY 1
    START WITH 1
    MAXVALUE 10000
    NOCYCLE ;
CREATE SEQUENCE DOAN_TU_SACH_SEQ
    INCREMENT BY 1
    START WITH 1
    MAXVALUE 10000
    NOCYCLE ;
CREATE SEQUENCE DOAN_TU_BANDOC_SEQ
    INCREMENT BY 1
    START WITH 1
    MAXVALUE 10000
    NOCYCLE ;
CREATE SEQUENCE DOAN_TU_MUONSACH_SEQ
    INCREMENT BY 1
    START WITH 1
    MAXVALUE 10000
    NOCYCLE ;
--4.	Viết script insert dữ liệu mẫu cho tất cả các bảng
INSERT INTO DOAN_TU_NXB(ID, MA, TEN, TRANG_THAI, DIA_CHI, MO_TA) VALUES (1, 1 , 'NGUYEN VAN A',1,'HÀ NỘI','CHƯA CÓ NY');
INSERT INTO DOAN_TU_NXB(ID, MA, TEN, TRANG_THAI, DIA_CHI, MO_TA) VALUES (2, 2 , 'NGUYEN VAN B',0,'HÀ NAM',' CÓ NY');
INSERT INTO DOAN_TU_NXB(ID, MA, TEN, TRANG_THAI, DIA_CHI, MO_TA) VALUES (3, 3 , 'NGUYEN VAN C',1,'PHÚC DIỄN',' CÓ NY');
INSERT INTO DOAN_TU_NXB(ID, MA, TEN, TRANG_THAI, DIA_CHI, MO_TA) VALUES (4, 4 , 'NGUYEN VAN D',0,'HÀ NỘI','CHƯA CÓ NY');
INSERT INTO DOAN_TU_NXB(ID, MA, TEN, TRANG_THAI, DIA_CHI, MO_TA) VALUES (5, 5 , 'NGUYEN VAN E',1,'HÀ NỘI','CHƯA CÓ NY');

INSERT INTO DOAN_TU_TACGIA(ID, MA_TACGIA, TEN_TAC_GIA, SDT_TAC_GIA, DIA_CHI_TAC_GIA, MO_TA_TAC_GIA) VALUES (1, 1 , 'NGUYEN VAN F','0123456789','HÀ NỘI','CHƯA CÓ NY');
INSERT INTO DOAN_TU_TACGIA(ID, MA_TACGIA, TEN_TAC_GIA, SDT_TAC_GIA, DIA_CHI_TAC_GIA, MO_TA_TAC_GIA) VALUES (2, 2 , 'NGUYEN VAN G','0134672353','LẠNG SƠN','CÓ NY');
INSERT INTO DOAN_TU_TACGIA(ID, MA_TACGIA, TEN_TAC_GIA, SDT_TAC_GIA, DIA_CHI_TAC_GIA, MO_TA_TAC_GIA) VALUES (3, 3 , 'NGUYEN VAN H','0546347534','MIỀN NAM','CÓ NY');
INSERT INTO DOAN_TU_TACGIA(ID, MA_TACGIA, TEN_TAC_GIA, SDT_TAC_GIA, DIA_CHI_TAC_GIA, MO_TA_TAC_GIA) VALUES (4, 4 , 'NGUYEN VAN I','0532654345','HÀ NỘI','CHƯA CÓ NY');
INSERT INTO DOAN_TU_TACGIA(ID, MA_TACGIA, TEN_TAC_GIA, SDT_TAC_GIA, DIA_CHI_TAC_GIA, MO_TA_TAC_GIA) VALUES (5, 5 , 'NGUYEN VAN J','0345623455','QUẢNG NINH','CHƯA CÓ NY');

INSERT INTO DOAN_TU_SACH(ID, MA_SACH, TEN_SACH, ID_NXB, ID_TACGIA, CHUDE_SẠCH, NAMXUATBAN, MO_TA_SACH, SOLUONGCONLAI, SOLUONGDANGMUON, TONGSOSACH)
VALUES (1, 1 , 'NGUYEN VAN K',1,1,'TOÁN','05/DEC/2022','HINHHOC','200','100','220');
INSERT INTO DOAN_TU_SACH(ID, MA_SACH, TEN_SACH, ID_NXB, ID_TACGIA, CHUDE_SẠCH, NAMXUATBAN, MO_TA_SACH, SOLUONGCONLAI, SOLUONGDANGMUON, TONGSOSACH) VALUES (2, 2 , 'NGUYEN VAN L',2,2,'VĂN','05/DEC/2022','EMBE','300','150','320');
INSERT INTO DOAN_TU_SACH(ID, MA_SACH, TEN_SACH, ID_NXB, ID_TACGIA, CHUDE_SẠCH, NAMXUATBAN, MO_TA_SACH, SOLUONGCONLAI, SOLUONGDANGMUON, TONGSOSACH) VALUES (3, 3 , 'NGUYEN VAN M',3,3,'HÓA','05/DEC/2023','BẢNG CỬU CHƯƠNG','400','200','420');
INSERT INTO DOAN_TU_SACH(ID, MA_SACH, TEN_SACH, ID_NXB, ID_TACGIA, CHUDE_SẠCH, NAMXUATBAN, MO_TA_SACH, SOLUONGCONLAI, SOLUONGDANGMUON, TONGSOSACH) VALUES (4, 4 , 'NGUYEN VAN N',4,4,'ĐỊA','05/DEC/2024','ALAT 12','500','250','520');
INSERT INTO DOAN_TU_SACH(ID, MA_SACH, TEN_SACH, ID_NXB, ID_TACGIA, CHUDE_SẠCH, NAMXUATBAN, MO_TA_SACH, SOLUONGCONLAI, SOLUONGDANGMUON, TONGSOSACH) VALUES (5, 5 , 'NGUYEN VAN O',5,5,'THỂ DỤC','05/DEC/2025','NHẢY CAO','600','300','620');

INSERT INTO DOAN_TU_BANDOC(ID, MA_BANDOC, TEN_BANDOC, SDT_BANDOC, DIACHI_BANDOC, NGAYSINH_BANDOC, NGAYTAOTK_BANDOC, HANG_BANDOC) VALUES (1, 1 , 'NGUYEN VAN P','0435634752','HÀ NỘI','05/DEC/2002','05/DEC/2022','Cao thủ');
INSERT INTO DOAN_TU_BANDOC(ID, MA_BANDOC, TEN_BANDOC, SDT_BANDOC, DIACHI_BANDOC, NGAYSINH_BANDOC, NGAYTAOTK_BANDOC, HANG_BANDOC) VALUES (2, 2 , 'NGUYEN VAN Q','0245345564','HÀ NỘI','05/DEC/2002','05/DEC/2021','Vàng');
INSERT INTO DOAN_TU_BANDOC(ID, MA_BANDOC, TEN_BANDOC, SDT_BANDOC, DIACHI_BANDOC, NGAYSINH_BANDOC, NGAYTAOTK_BANDOC, HANG_BANDOC) VALUES (3, 3 , 'NGUYEN VAN R','0456743242','HÀ NỘI','05/DEC/2002','05/DEC/2023','Đồng');
INSERT INTO DOAN_TU_BANDOC(ID, MA_BANDOC, TEN_BANDOC, SDT_BANDOC, DIACHI_BANDOC, NGAYSINH_BANDOC, NGAYTAOTK_BANDOC, HANG_BANDOC) VALUES (4, 4 , 'NGUYEN VAN S','0423863646','HÀ NỘI','05/DEC/2002','05/DEC/2024','Bạc');
INSERT INTO DOAN_TU_BANDOC(ID, MA_BANDOC, TEN_BANDOC, SDT_BANDOC, DIACHI_BANDOC, NGAYSINH_BANDOC, NGAYTAOTK_BANDOC, HANG_BANDOC) VALUES (5, 5 , 'NGUYEN VAN T','0576329563','HÀ NỘI','05/DEC/2002','05/DEC/2025','Gỗ');


INSERT INTO DOAN_TU_MUONSACH(ID, ID_BANDOC, ID_SACH, SOLUONG_MUONSACH, NGAYMUON_MUONSACH, NGAYTRA_MUONSACH, TRANGTHAI_MUONSACH, GHICHU_MUONSACH)
VALUES (1, 1,1, '003', '12/DEC/2026','13/DEC/2026',1,'bịp');
INSERT INTO DOAN_TU_MUONSACH(ID, ID_BANDOC, ID_SACH, SOLUONG_MUONSACH, NGAYMUON_MUONSACH, NGAYTRA_MUONSACH, TRANGTHAI_MUONSACH, GHICHU_MUONSACH) VALUES (2, 2,2, '001', '13/DEC/2026','14/DEC/2026',0,'bịp');
INSERT INTO DOAN_TU_MUONSACH(ID, ID_BANDOC, ID_SACH, SOLUONG_MUONSACH, NGAYMUON_MUONSACH, NGAYTRA_MUONSACH, TRANGTHAI_MUONSACH, GHICHU_MUONSACH) VALUES (3, 3,3, '002', '14/DEC/2026','15/DEC/2026',1,'bịp');
INSERT INTO DOAN_TU_MUONSACH(ID, ID_BANDOC, ID_SACH, SOLUONG_MUONSACH, NGAYMUON_MUONSACH, NGAYTRA_MUONSACH, TRANGTHAI_MUONSACH, GHICHU_MUONSACH) VALUES (4, 4,4, '005', '15/DEC/2026','16/DEC/2026',0,'bịp');
INSERT INTO DOAN_TU_MUONSACH(ID, ID_BANDOC, ID_SACH, SOLUONG_MUONSACH, NGAYMUON_MUONSACH, NGAYTRA_MUONSACH, TRANGTHAI_MUONSACH, GHICHU_MUONSACH) VALUES (5, 5,5, '002', '16/DEC/2026','17/DEC/2026',1,'bịp');
--5.Hiển thị dách sách tác giả và tổng số lượng sách của tác giả gồm các trường thông tin:
SELECT ID_TACGIA,TEN_TAC_GIA,CHUDE_SẠCH,SOLUONGCONLAI
FROM  DOAN_TU_SACH JOIN DOAN_TU_TACGIA ON DOAN_TU_SACH.ID_TACGIA = DOAN_TU_TACGIA.ID
ORDER BY TONGSOSACH DESC
;
--6.	Hiển thị 10 quyển sách có số lượng được mượn nhiều nhất gồm các trường thông tin:
SELECT  MA_SACH,TEN_SACH, TEN, TEN_TAC_GIA,CHUDE_SẠCH,NAMXUATBAN,SOLUONGCONLAI,SOLUONGDANGMUON,TONGSOSACH
FROM DOAN_TU_SACH S JOIN DOAN_TU_NXB N ON S.ID_NXB = N.ID JOIN DOAN_TU_TACGIA TG ON S.ID_TACGIA = TG.ID
WHERE  ROWNUM <11 ORDER BY SOLUONGCONLAI DESC;
--7.	Hiển thị  thông tin bạn đọc và sách được mượn từ ngày đầu tháng hiện tại đến thời điểm hiện tại.
SELECT MA_BANDOC,TEN_BANDOC,MA_SACH,TEN_SACH,NGAYMUON_MUONSACH,SOLUONGCONLAI
FROM DOAN_TU_BANDOC BD JOIN DOAN_TU_MUONSACH MS ON BD.ID = MS.ID_BANDOC JOIN DOAN_TU_SACH S ON MS.ID_SACH = S.ID
ORDER BY MS.NGAYMUON_MUONSACH DESC, BD.TEN_BANDOC ;
--8.	Hiển thị 10 quyển sách có số lượng được mượn nhiều nhất tính từ đầu năm 2022
--9.	Hiển thị danh sách bạn đọc và số lần mượn sách tính từ đầu năm 2022 sắp xếp theo tên bạn đọc tăng dần:
-- SELECT BD.MA_BAN_DOC , BD.TEN_BAN_DOC FROM DOAN_TU_BANDOC BD
--10.	Hiển thị thông tin bạn đọc gồm có:
SELECT *FROM DOAN_TU_BANDOC;
SELECT MA_BANDOC,TEN_BANDOC, TO_NUMBER(TO_CHAR(SYSDATE,'YYYY')) - TO_NUMBER(TO_CHAR(NGAYSINH_BANDOC,'YYYY')) AS TUỔI
FROM DOAN_TU_BANDOC;
--11.	Thống kê tổng số bạn đọc theo độ tuổi
SELECT (TO_CHAR(SYSDATE,'YYYY') - TO_CHAR(NGAYSINH_BANDOC,'YYYY')) AS TUỔI ,COUNT(ID) AS TỔNGSỐBẠNĐỌC
FROM DOAN_TU_BANDOC GROUP BY (TO_CHAR(SYSDATE,'YYYY'))- TO_CHAR(NGAYSINH_BANDOC,'YYYY');
--12.	Thống kê số lượng sách được xuất bản theo Nhà Xuất Bản, Theo năm xuất bản.
--13.	Hiển thị 5 quyển sách được các bạn đọc có độ tuổi từ 18 đến 25 mượn nhiều nhất tính từ đầu năm 2022. (Tính theo trường số lượng mượn của sách)
--14.	Hiển thị toàn bộ bạn đọc và sách mà bạn đọc đấy mượn, sẽ có bạn chưa mượn vẫn cần hiển thị và tên sách để là null.